#!/bin/bash
# Update and install Apache HTTP server
sudo su
yum update -y
yum install -y httpd aws-cli

cd ../../../
mkdir /var/www/html
cd /var/www/html

sudo yum install -y nodejs

npm install oidc-client-ts --save

# Start the HTTP server
systemctl start httpd
systemctl enable httpd



# Download individual files from S3
aws s3 cp s3://saa-msc-web-app-files/webapp/upload.html upload.html
aws s3 cp s3://saa-msc-web-app-files/webapp/signin.html index.html
aws s3 cp s3://saa-msc-web-app-files/webapp/accessdenied.html accessdenied.html
aws s3 cp s3://saa-msc-web-app-files/webapp/app.js app.js
aws s3 cp s3://saa-msc-web-app-files/webapp/style.css style.css

# Set permissions for the files
chmod -R 755 .




curl -X POST https://z0uqpw0kcg.execute-api.us-east-1.amazonaws.com \
  -H "Authorization: Bearer eyJraWQiOiJlMVAyOEpsVkttZXVOVmhkQk1nUE4yM1NnVE8rbXllekp2b1ZCYlVkZmNnPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJjNGQ4ODQzOC05MDExLTcwMzgtMDEyZi1hYzExNTk0NGM4YWEiLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3VzLWVhc3QtMV85cHJ6TWZrZkEiLCJjb2duaXRvOnVzZXJuYW1lIjoic3RlcGhhbmllIiwib3JpZ2luX2p0aSI6IjhkMzY3NDQ3LTcwMzctNGNmMy1hOTU4LWQ2OTU4YzJiNzg0ZSIsImF1ZCI6IjNwY2o3aHNyM2QzMnNqM3BpNjhvZWFmNmczIiwiZXZlbnRfaWQiOiI4YTVjOTlmMi03M2YzLTRmMDYtODE2Zi01YjE2OGZkZjM2ZmIiLCJ0b2tlbl91c2UiOiJpZCIsImF1dGhfdGltZSI6MTczNDI0NDA0MiwiZXhwIjoxNzM0MjQ3NjQyLCJpYXQiOjE3MzQyNDQwNDIsImp0aSI6IjQwMzMxMWM1LTU5MGItNGU5NS1iYmI3LWU3Mjk4MGQzNzE2NyIsImVtYWlsIjoic3RlcGhhbmllLmNvdXRvQGNkdy5jb20ifQ.31KZn_TnwYIXrUiF8p6M6RKiTTkKNMariuz-6SoFPKqbU75OHUWWAB3BRaRAwEMVe___VqVfTpMBxtS1eMw7Ug60R9t4rKq2kxU9fSA3DzHwOekxQ8ty2-1N7B1_Zq7ddIUX4BV4HxINmbNUvxRAHyN9M21MKfj7whKnjJGmBH4MCwzX29tWdUU97yZHxDR3T2dbT_9o6W8L0bah3H1YNVhMQxew8dF2Z7AmrP99rSgc02xZUlubLo7pO__TR20f4DaK7_6POlq4VwFLX_Ofxapze_WfgnulvObrNl8fRqR9O4_U_Fd7uumVBcQKrbgcLvdqsKCi74bH2ufQbszToQ" \
  -H "Content-Type: application/json" \
  -d '{"key": "test-file.txt", "action": "putObject"}'


  curl -Method POST -Uri "https://z0uqpw0kcg.execute-api.us-east-1.amazonaws.com" `
    -Headers @{
        "Authorization" = "Bearer eyJraWQiOiJlMVAyOEpsVkttZXVOVmhkQk1nUE4yM1NnVE8rbXllekp2b1ZCYlVkZmNnPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJjNGQ4ODQzOC05MDExLTcwMzgtMDEyZi1hYzExNTk0NGM4YWEiLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3VzLWVhc3QtMV85cHJ6TWZrZkEiLCJjb2duaXRvOnVzZXJuYW1lIjoic3RlcGhhbmllIiwib3JpZ2luX2p0aSI6Ijc2ZjkyMzJjLTA3YzktNGQ5YS1iMDQ5LTFhZWEzZjM2NjBlYiIsImF1ZCI6IjNwY2o3aHNyM2QzMnNqM3BpNjhvZWFmNmczIiwiZXZlbnRfaWQiOiJkNGMwMzlhNC0wMTg3LTRkNzAtOGU2NC02NjE5NzU5ZmI0NjAiLCJ0b2tlbl91c2UiOiJpZCIsImF1dGhfdGltZSI6MTczNDI0NTM5MywiZXhwIjoxNzM0MjQ4OTkzLCJpYXQiOjE3MzQyNDUzOTMsImp0aSI6IjIzOTVjZDMyLTAyZTEtNDZiOC05ZmZmLTg5N2Q2MTVhZGI3OSIsImVtYWlsIjoic3RlcGhhbmllLmNvdXRvQGNkdy5jb20ifQ.KM7Ik3hjKV3LBFx3lrOsYBZGmqZtSsdIbD7w5mHofHFMpckGzT6AiZ_N-Veo5Vqgu3M4rNskasDcw9oOkhTHDXA2CB9sxYPLXfZwFrrz2aowVBlWvHaC3JkRRSaXtX2W1UglGuQI1DFvo9oQA4MjD8LfjBLuiTA7ccVnBeoZI2m54xjrYo_cO5QniI6Rk1tpHBHNsQTo-5bGqNSZ7wfFK72jyBCOCTXs7CDlToCgjzb0wGk6i-opGlVpAmgySS-ts9FJtr7-juI9jWn-52p0-CkTPt-keEKrTleTzebwDZsT1aLoK1wiD8oXra28OivmjK60kT-MbrAN3YXq6_PY6Q"
        "Content-Type" = "application/json"
    } `
    -Body '{"key": "test-file.txt", "action": "putObject"}'
